<div class="row">
  <div class="col-md-12">
    <nb-card class="inline-form-card">
      <nb-card-header>Reportes</nb-card-header>
      <!--  PROMOTOR  -->
      <nb-card-body *ngIf="module === 'promotor'">
        <div class="row">
          <div class="col-md-1">
            <label for="inputFolio" class="label">Folio</label>
          </div>
          <div class="col-md-3">
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.folio"
              [disabled]="filterParams.emisor.length > 0 || filterParams.remitente.length > 0" id="inputFolio"
              placeholder="Folio PreCFDI">
          </div>
          <div class="col-md-1">
            <label for="inputEmisor" class="label">Emisor</label>
          </div>
          <div class="col-md-3">
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.emisor"
              [disabled]="filterParams.folio.length > 0 || filterParams.remitente.length > 0" id="inputEmisor"
              placeholder="Razón Social Emisor">
          </div>
          <div class="col-md-1">
            <label for="InputReceptor" class="label">Receptor</label>
          </div>
          <div class="col-md-3">
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.remitente"
              [disabled]="filterParams.folio.length > 0 || filterParams.emisor.length > 0" id="InputReceptor"
              placeholder="Razón Social Receptor">
          </div>
        </div>
        <br>
        <div class="row">
          <div class="col-md-1">
            <label for="inputStatus" class="label">Estatus factura</label>
          </div>
          <div class="col-md-2">
            <select id="inputStatus" style="display:block;" class="form-control" [(ngModel)]="filterParams.status">
              <option value="*">Todos</option>
              <option value="1">Validacion operaciones</option>
              <option value="2">Validacion tesoreria</option>
              <option value="4">Por Timbrar</option>
              <option value="3">Timbrada</option>
              <option value="5">Rechazo tesoreria</option>
              <option value="6">Rechazo Operaciones</option>
              <option value="7">Cancelada</option>
            </select>
          </div>
          <div class="col-md-1">
            <label for="inputTimbrado" class="label">Desde</label>
          </div>
          <div class="col-md-3">
            <input nbInput placeholder="Desde" [nbDatepicker]="sincepicker" fullWidth style="display:block;"
              [(ngModel)]="filterParams.since">
            <nb-datepicker #sincepicker></nb-datepicker>
          </div>
          <div class="col-md-1">
            <label for="inputTimbrado" class="label">Hasta</label>
          </div>
          <div class="col-md-3">
            <input nbInput placeholder="Hasta" [nbDatepicker]="topicker" fullWidth style="display:block;"
              [(ngModel)]="filterParams.to">
            <nb-datepicker #topicker></nb-datepicker>
          </div>
          <div class="col-md-1">
            <button type="button" (click)="updateDataTable(0,10,filterParams)" nbButton status="primary">BUSCAR</button>
          </div>
        </div>
      </nb-card-body>

      <!--  OPERACIONES  -->
      <nb-card-body *ngIf="module === 'operaciones' || module === 'administracion' ||  module === 'tesoreria' ">
        <div class="row">
          <div class="col-md-1">
            <label for="inputFolio" class="label">Folio</label>
          </div>
          <div class="col-md-2">
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.folio"
              [disabled]="filterParams.emisor.length > 0 || filterParams.remitente.length > 0" id="inputFolio"
              placeholder="Folio PreCFDI">
          </div>
          <div class="col-md-1">
            <label for="inputEmisor" class="label">Emisor</label>
          </div>
          <div class="col-md-2">
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.emisor"
              [disabled]="filterParams.folio.length > 0 || filterParams.remitente.length > 0" id="inputEmisor"
              placeholder="Razón Social Emisor">
          </div>
          <div class="col-md-1">
            <label for="InputReceptor" class="label">Receptor</label>
          </div>
          <div class="col-md-2">
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.remitente"
              [disabled]="filterParams.folio.length > 0 || filterParams.emisor.length > 0" id="InputReceptor"
              placeholder="Razón Social Receptor">
          </div>
          <div class="col-md-1">
            <label for="inputStatus" class="label">Estatus factura</label>
          </div>
          <div class="col-md-2">
            <select id="inputStatus" style="display:block;" class="form-control" [(ngModel)]="filterParams.status"
              [disabled]="statusFlag">
              <option value="*">Todos</option>
              <option value="1">Validacion operaciones</option>
              <option value="2">Validacion tesoreria</option>
              <option value="4">Por Timbrar</option>
              <option value="3">Timbrada</option>
              <option value="5">Rechazo tesoreria</option>
              <option value="6">Rechazo Operaciones</option>
              <option value="7">Cancelada</option>
            </select>
          </div>
        </div>
        <br>
        <div class="row">
          <div class="col-md-1">
            <label for="inputPromotor" class="label">Promotor</label>
          </div>
          <div class="col-md-2">
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.solicitante" id="inputPromotor"
              placeholder="Correo promotor">
          </div>
          <div class="col-md-1">
            <label for="inputTimbrado" class="label">Desde</label>
          </div>
          <div class="col-md-3">
            <input nbInput placeholder="Desde" [nbDatepicker]="sincepicker" fullWidth style="display:block;"
              [(ngModel)]="filterParams.since">
            <nb-datepicker #sincepicker></nb-datepicker>
          </div>
          <div class="col-md-1">
            <label for="inputTimbrado" class="label">Hasta</label>
          </div>
          <div class="col-md-3">
            <input nbInput placeholder="Hasta" [nbDatepicker]="topicker" fullWidth style="display:block;"
              [(ngModel)]="filterParams.to">
            <nb-datepicker #topicker></nb-datepicker>
          </div>
          <div class="col-md-1">
            <button type="button" (click)="updateDataTable(0,10,filterParams)" nbButton status="primary">BUSCAR</button>
          </div>
        </div>
      </nb-card-body>

      <!--  CONTABILIDAD  -->
      <nb-card-body *ngIf="module === 'contabilidad'">
        <div class="row">
          <div class="col-md-1">
            <label for="inputLinea" class="label">Línea Emisora</label>
          </div>
          <div class="col-md-2">
            <select id="inputLinea" style="display:block;" class="form-control" [(ngModel)]="filterParams.lineaEmisor">
              <option value="A">Línea A</option>
              <option value="B">Línea B</option>
              <option value="C">Línea C</option>
              <option value="D">Línea D</option>
            </select>
          </div>
          <div class="col-md-1">
            <label for="inputEmisor" class="label">Emisor</label>
          </div>
          <div class="col-md-3">
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.emisor"
              [disabled]="filterParams.folio.length > 0 || filterParams.remitente.length > 0" id="inputEmisor"
              placeholder="Razón Social Emisor">
          </div>
          <div class="col-md-1">
            <label for="InputReceptor" class="label">Receptor</label>
          </div>
          <div class="col-md-3">
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.remitente"
              [disabled]="filterParams.folio.length > 0 || filterParams.emisor.length > 0" id="InputReceptor"
              placeholder="Razón Social Receptor">
          </div>

        </div>
        <br>
        <div class="row">
          <div class="col-md-1">
            <label for="inputStatus" class="label">Estatus factura</label>
          </div>
          <div class="col-md-2">
            <select id="inputStatus" style="display:block;" class="form-control" [(ngModel)]="filterParams.status"
              [disabled]="statusFlag">
              <option value="8">Por timbrar</option>
              <option value="3">Timbrada</option>
              <option value="7">Cancelada</option>
              <option value="9">Rechazada contabilidad</option>
              <option value="5">Rechazada tesoreria</option>
              <option value="6">Rechazada operaciones</option>

            </select>
          </div>
          <div class="col-md-1">
            <label for="inputTimbrado" class="label">Desde</label>
          </div>
          <div class="col-md-3">
            <input nbInput placeholder="Desde" [nbDatepicker]="sincepicker" fullWidth style="display:block;"
              [(ngModel)]="filterParams.since">
            <nb-datepicker #sincepicker></nb-datepicker>
          </div>
          <div class="col-md-1">
            <label for="inputTimbrado" class="label">Hasta</label>
          </div>
          <div class="col-md-3">
            <input nbInput placeholder="Hasta" [nbDatepicker]="topicker" fullWidth style="display:block;"
              [(ngModel)]="filterParams.to">
            <nb-datepicker #topicker></nb-datepicker>
          </div>
          <div class="col-md-1">
            <button type="button" (click)="updateDataTable(0,10,filterParams)" nbButton status="primary">BUSCAR</button>
          </div>
        </div>
      </nb-card-body>



    </nb-card>
  </div>
</div>


<div class="row">
  <div class="col-md-12">
    <nb-card [nbSpinner]="loading" nbSpinnerStatus="info" nbSpinnerSize="giant">
      <nb-card-header>Facturas</nb-card-header>
      <nb-card-body>

        <div *ngIf="page.empty == true" class="alert alert-primary" role="alert">
          No se encontraron resultados
        </div>
        <div class="clearfix">
          <strong>Resultados</strong>
          <nb-select *ngIf="page.last==false || page.first==true" [selected]="pageSize"
            (selectedChange)="onChangePageSize($event)" id="inputPageSize" class="float-right">
            <nb-option value="10">10</nb-option>
            <nb-option *ngIf="page.number<(page.totalElements/20)" value="20">20</nb-option>
            <nb-option *ngIf="page.number<(page.totalElements/50)" value="50">50</nb-option>
          </nb-select>
          <button type="button" *ngIf="module === 'promotor'" (click)="downloadHandler()"
            class="btn btn-success float-right"><i class="fa fa-download"></i></button>
          <button type="button" *ngIf="module !== 'promotor'" (click)="downloadInvoicesReports()"
            class="btn btn-success float-right"><i class="fa fa-download"></i>Facturas</button>
          <button type="button" *ngIf="module !== 'promotor'" (click)="downloadComplementReports()"
            class="btn btn-success float-right"><i class="fa fa-download"></i>Complementos</button>


        </div>
        <div class="table-responsive" *ngIf="page.empty == false">

          <table class="table">
            <thead class="thead-light">
              <tr>
                <th class="text-center" style="width: 170px;">Acciones</th>
                <th class="text-center">Folio</th>
                <th class="text-center">RFC Empresa</th>
                <th class="text-center">Razón Social Empresa</th>
                <th class="text-center">RFC Cliente</th>
                <th class="text-center">Razón Social Cliente</th>
                <th class="text-center">Tipo Documento</th>
                <th class="text-center">Método Pago</th>
                <th class="text-center">Estatus factura</th>
                <th class="text-center">Estatus pago</th>
                <th class="text-center">Total</th>
                <th class="text-center">Promotor</th>
                <th class="text-center">Solicitud</th>
                <th class="text-center">Actualización</th>

              </tr>
            </thead>
            <tbody>
              
              <tr *ngFor="let fila of page.content" >
               
                <td scope="row p-1" class="text-center" style="min-width: 160px;">
                  <button type="button" class="btn-sm btn-outline-primary" 
                    (click)="redirectToCfdi(fila.folioPadre || fila.folio)"><i class="fa fa-search"></i>
                  </button>
                  <button type="button" class="btn-sm btn-outline-primary" *ngIf="module === 'promotor'"
                    [ngClass]="{'btn-outline-secondary': (fila.tipoDocumento === 'Factura' && fila.metodoPago === 'PPD') || (fila.statusFactura !== 'Validacion operaciones' && fila.statusFactura !== 'Validacion tesoreria' ), 'btn-outline-primary':(fila.tipoDocumento == 'Complemento' || fila.metodoPago == 'PUE') && (fila.statusFactura === 'Validacion operaciones' || fila.statusFactura === 'Validacion tesoreria') }"
                    [disabled]="(fila.tipoDocumento === 'Factura' && fila.metodoPago === 'PPD') || (fila.statusFactura !== 'Validacion operaciones' && fila.statusFactura !== 'Validacion tesoreria' )"
                    (click)="redirectToPreferences(fila.folio)"><i class="fa fa-wallet"></i>
                  </button>
                  <button type="button" class="btn-sm btn-outline-primary"
                    *ngIf="module !== 'promotor' && module !== 'contabilidad'"
                    [ngClass]="{'btn-outline-secondary': (fila.tipoDocumento === 'Factura' && fila.metodoPago === 'PPD'), 'btn-outline-primary':(fila.tipoDocumento == 'Complemento' || fila.metodoPago == 'PUE') }"
                    [disabled]=" (fila.tipoDocumento === 'Factura' && fila.metodoPago === 'PPD')"
                    (click)="redirectToDevolutionDetails(fila.folio)"><i class="fa fa-university"></i>
                  </button>
                  <button type="button"  class="btn-sm btn-outline-primary" 
                    (click)="downloadPdf(fila.rfcEmisor,fila.rfcRemitente,fila.folio)">
                    <i class="fa fa-file-pdf"></i>
                  </button>
                  <button type="button" class="btn-sm btn-outline-primary" [disabled]="fila.statusFactura !== 'Timbrada'"
                  [ngClass]="{'btn-outline-secondary': fila.statusFactura !== 'Timbrada' , 'btn-outline-primary':fila.statusFactura === 'Timbrada'}"
                  (click)="downloadXml(fila.rfcEmisor,fila.rfcRemitente,fila.folio)">
                    <i class="fa fa-code"></i>
                  </button>
                  <button type="button" class="btn-sm btn-outline-primary" [disabled]="fila.statusFactura !== 'Timbrada'"
                  [ngClass]="{'btn-outline-secondary': fila.statusFactura !== 'Timbrada' , 'btn-outline-primary':fila.statusFactura === 'Timbrada'}"
                  (click)="reSendEmail(fila.folio)">
                    <i class="fa fa-reply-all"></i>
                  </button>
                </td>
              
                <td scope="row">{{fila.folio}}</td>
                <td scope="row">{{fila.rfcEmisor}}</td>
                <td scope="row">{{fila.razonSocialEmisor}}</td>
                <td scope="row">{{fila.rfcRemitente}}</td>
                <td scope="row">{{fila.razonSocialRemitente}}</td>
                <td scope="row">{{fila.tipoDocumento}}</td>
                <td scope="row">{{fila.metodoPago}}</td>
                <td scope="row">{{fila.statusFactura}}</td>
                <td scope="row">{{fila.statusPago}}</td>
                <td scope="row">{{fila.total}}</td>
                <td scope="row">{{fila.solicitante}}</td>
                <td scope="row">{{fila.fechaCreacion}}</td>
                <td scope="row">{{fila.fechaActualizacion}}</td>
              </tr>
            
            </tbody>
          </table>

          <ul class="pagination" *ngIf="page.totalElements > 1">
            <li class="page-item" *ngIf="page.first==false"><button class="btn page-link"
                (click)="updateDataTable(0,page.size)"><i class="nb-arrow-left"></i></button></li>
            <li class="page-item" *ngIf="page.first==false"><button class="btn page-link"
                (click)="updateDataTable(page.number-1,page.size)">{{page.number}}</button></li>
            <li class="page-item active"><a class="page-link"><strong>{{page.number+1}}</strong></a></li>
            <li class="page-item" *ngIf="page.last==false"><button class="btn page-link"
                (click)="updateDataTable(page.number+1,page.size)">{{page.number+2}}</button></li>
            <li class="page-item" *ngIf="page.last==false"><button class="btn page-link"
                (click)="updateDataTable(page.totalPages-1,page.size)"><i class="nb-arrow-right"></i></button></li>
          </ul>
        </div>
      </nb-card-body>
    </nb-card>
  </div>
</div>