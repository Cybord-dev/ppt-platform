<nb-card>
  <nb-card-header>Solicitud CFDI</nb-card-header>
  <nb-card-body>
    <div class="overflow-auto" style="width: 80vw; height: 65vh;">
      <div class="alert alert-warning" *ngIf="errorMessages.length > 0" role="alert">
        <p *ngFor="let message of errorMessages">{{message}}</p>
      </div>

      <p class="font-weight-bold">Información Emisor y Receptor</p>
      <div class="form-inline">
        <p class="font-weight-bold">Emisor : </p>
        <p>{{factura.rfcEmisor}}</p>
        <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
        <p>{{factura.razonSocialEmisor}}</p>
        <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
        <p class="font-weight-bold">Receptor : </p>
        <p>{{factura.rfcRemitente}}</p>
        <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
        <p>{{factura.razonSocialRemitente}}</p>
      </div>

      <br>
      <p class="font-weight-bold">Información CFDI</p>
      <div class="row">
        <div class="col-sm-2">
          <label for="inputDocType" class="label">Tipo documento</label>
          <select id="inputDocType" class="form-control" fullWidth>
            <option>FACTURA</option>
          </select>
        </div>
        <div class="col-sm-4">
          <label for="inputPaytype" class="label">Uso CFDI</label>
          <select selected="1" id="inputPaytype" style="display:block;" class="form-control"
            [(ngModel)]="formInfo.usoCfdi" (change)="onUsoCfdiSelected($event.target.value)">
            <option value="*">Seleccionar</option>
            <option *ngFor="let clave of usoCfdiCat" [(value)]="clave.clave">{{clave.clave}}-{{clave.descripcion}}</option>
          </select>
        </div>
        <div class="col-sm-1">
          <label for="inputCoin" class="label">Moneda</label>
          <select selected="1" id="inputCoin" style="display:block;" class="form-control"
            [(ngModel)]="factura.cfdi.moneda">
            <option value="MXN">Peso MX</option>
          </select>
        </div>
        <div class="col-sm-3">
          <label for="inputPayMethod" class="label">Metodo de Pago</label>
          <select selected="1" id="inputPayMethod" style="display:block;" class="form-control"
            [(ngModel)]="factura.cfdi.metodoPago" (change)="onPayMethodSelected($event.target.value)">
            <option value="*">Seleccionar</option>
            <option value="PUE">Factura pagada (PUE)</option>
            <option value="PPD">Factura pago por definir(PPD)</option>
          </select>
        </div>
        <div class="col-sm-2">
          <label for="inputPaytype" class="label">Forma de Pago</label>
          <select selected="1" id="inputPaytype" style="display:block;" class="form-control"
            [(ngModel)]="formInfo.payType" (change)="onFormaDePagoSelected($event.target.value)">
            <option value="*">Seleccionar</option>
            <option *ngFor="let payType of payTypeCat" [(value)]="payType.id">{{payType.nombre}}</option>
          </select>
        </div>

      </div>      
      
      <p class="font-weight-bold">Conceptos factura</p>
      <ngx-conceptos [cfdi]="factura.cfdi" [concepto]="newConcep" [allowEdit]="this.factura.folio === undefined">
      </ngx-conceptos>

  
      <div class="alert alert-warning" role="alert" *ngIf="!validarRestante()">
        El monto requerido de la factura es de {{transfer.importe | currency}} el monto faltante es de
        {{(transfer.importe - factura.cfdi.total) | currency}}
      </div>

      <div class="alert alert-success" *ngIf="successMessage!=undefined" role="alert">
        {{successMessage}}
      </div>

      <div *ngIf="factura.metodoPago=='PPD' && complementos.length>0">
        <p class="font-weight-bold">Complementos</p>
        <br>
        <div class="table-responsive">
          <table class="table">
            <thead class="thead-light">
              <tr>
                <th class="text-center">Acciones</th>
                <th class="text-center">Folio</th>
                <th class="text-center">Emisor</th>
                <th class="text-center">Receptor</th>
                <th class="text-center">Metodo Pago</th>
                <th class="text-center">Estatus Validacion</th>
                <th class="text-center">Estatus Pago</th>
                <th class="text-center">Monto</th>
                <th class="text-center">Fecha Solicitud</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let complemento of complementos">
                <td scope="row" class="text-center">
                  <button type="button" [disabled]="complemento.statusFactura !='Timbrada'" class="btn"
                    [ngClass]="{'btn-outline-secondary': complemento.statusFactura !='Timbrada', 'btn-outline-success':complemento.statusFactura =='Timbrada'}"
                    (click)="downloadPdf(complemento.folio)">
                    <i class="fa fa-file-pdf"></i>
                  </button>&nbsp;&nbsp;
                  <button type="button" [disabled]="complemento.statusFactura !='Timbrada'" class="btn"
                    [ngClass]="{'btn-outline-secondary': complemento.statusFactura !='Timbrada', 'btn-outline-success':complemento.statusFactura =='Timbrada'}"
                    (click)="downloadXml(complemento.folio)">
                    <i class="fa fa-code"></i>
                  </button>&nbsp;&nbsp;
                  <button type="button" [disabled]="complemento.statusFactura != 'Validacion operaciones' || loading"
                    class="btn"
                    [ngClass]="{'btn-outline-secondary': complemento.statusFactura =='Timbrada', 'btn-outline-success':complemento.statusFactura !='Timbrada'}"
                    (click)="timbrarFactura(complemento,dialog)">
                    <i class="fa fa-check-circle"></i>
                  </button>&nbsp;&nbsp;
                  <button type="button" [disabled]="complemento.statusFactura !='Timbrada' || loading" class="btn"
                    [ngClass]="{'btn-outline-secondary': complemento.statusFactura !='Timbrada', 'btn-outline-danger':complemento.statusFactura =='Timbrada'}"
                    (click)="cancelarFactura(complemento)">
                    <i class="fa fa-calendar-times"></i>
                  </button>
                </td>
                <td scope="row" class="text-center">{{complemento.folio}}</td>
                <td scope="row" class="text-center">{{complemento.rfcEmisor}}</td>
                <td scope="row" class="text-center">{{complemento.rfcRemitente}}</td>
                <td scope="row" class="text-center">{{complemento.metodoPago}}</td>
                <td scope="row" class="text-center">{{complemento.statusFactura}}</td>
                <td scope="row" class="text-center">{{complemento.statusPago}}</td>
                <td scope="row" class="text-center">{{complemento.total}}</td>
                <td scope="row" class="text-center">{{complemento.fechaCreacion}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>





    </div>
  </nb-card-body>
  <nb-card-footer>
    <div class="clearfix">
      <button type="button" class="float-left btn btn-warning" (click)="exit()">Salir</button>
      <button type="button" class="btn btn-success float-left" (click)="calcularPrecioUnitario(newConcep)">Calcular Precio Unitario</button>
      <button type="button" class="btn btn-info float-right" (click)="limpiarForma()">LIMPIAR</button>
      <button type="button" class="btn btn-success float-right" [disabled]="!validarRestante()" (click)="solicitarCfdi()">SOLICITAR CFDI</button>
    </div>
  </nb-card-footer>
</nb-card>